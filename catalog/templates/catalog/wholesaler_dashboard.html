{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="min-h-screen bg-gray-50 pb-20">

  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold">My Products</h1>
        <!-- <a href="{% url 'catalog:product_add' %}" class="bg-black text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-gray-800 transition">
            + Add Product
        </a> -->
    </div>

    <!-- Stats Cards (3-column grid, clickable) -->
    <div class="grid grid-cols-3 gap-4 mb-6 text-center">
        <!-- Total Products -->
        <a href="{% url 'catalog:wholesaler_dashboard' %}?filter=all" class="bg-white rounded-xl shadow p-4 flex flex-col items-center hover:shadow-md transition">
            <div class="text-2xl font-semibold">{{ total_products }}</div>
            <div class="text-sm text-gray-500 mt-1">Products</div>
        </a>

        <!-- Out of Stock -->
        <a href="{% url 'catalog:wholesaler_dashboard' %}?filter=out" class="bg-white rounded-xl shadow p-4 flex flex-col items-center hover:shadow-md transition">
            <div class="text-2xl font-semibold text-red-600">{{ out_of_stock }}</div>
            <div class="text-sm text-gray-500 mt-1">Out of Stock</div>
        </a>

        <!-- Low Stock -->
        <a href="{% url 'catalog:wholesaler_dashboard' %}?filter=low" class="bg-white rounded-xl shadow p-4 flex flex-col items-center hover:shadow-md transition">
            <div class="text-2xl font-semibold text-yellow-600">{{ low_stock }}</div>
            <div class="text-sm text-gray-500 mt-1">Low Stock</div>
        </a>
    </div>

    <!-- Product Cards Grid -->
    <div class="grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4">
      {% for product in products %}
      <div class="bg-white rounded-xl shadow flex flex-col transition group">
        <a href="{% url 'catalog:product_edit' product.pk %}" class="p-4 flex-grow">
          {% if product.image %}
            <img src="{{ product.image.url }}" alt="{{ product.name }}" class="w-full h-40 object-cover rounded-lg mb-3">
          {% else %}
            <div class="w-full h-40 bg-gray-100 rounded-lg flex items-center justify-center text-gray-400">No Image</div>
          {% endif %}
          <div class="mb-2">
            <p class="font-semibold text-gray-800 truncate">{{ product.name }}</p>
            <p class="text-xs text-gray-500">{{ product.sku }}</p>
          </div>
        </a>
        
        <div class="flex justify-between items-center mt-auto p-4 border-t">
          <div class="flex items-center gap-1 text-gray-700">
            <span class="font-semibold">â‚¹</span>
            <span>{{ product.wholesale_price }}</span>
          </div>
          <!-- <div class="text-sm text-gray-600">{{ product.total_stock }} pcs</div> -->
          
          <div class="relative dropdown">
            <button class="dropdown-toggle p-1 rounded-full hover:bg-gray-100">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
                <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z" />
              </svg>
            </button>
            <div class="dropdown-menu absolute right-0 bottom-full mb-2 w-32 bg-white border rounded-lg shadow-lg hidden z-10">
              <a href="{% url 'catalog:product_detail' product.pk %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" target="_blank">View</a>
              <form action="{% url 'catalog:delete_product' product.pk %}" method="post" onsubmit="return confirm('Are you sure you want to delete this product?');">
                {% csrf_token %}
                <button type="submit" class="block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100">Remove</button>
              </form>
            </div>
          </div>
        </div>
      </div>
      {% empty %}
      <p class="text-gray-500 col-span-full">No products yet. Click "+ Add Product" to get started.</p>
      {% endfor %}
    </div>
  </main>

  <!-- Floating Add Product Button -->
  <a href="{% url 'catalog:product_add' %}" 
     class="fixed bottom-20 right-6 bg-black text-white rounded-full w-14 h-14 flex items-center justify-center shadow-lg hover:bg-gray-800 transition">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
    </svg>
  </a>

  <!-- Bottom Navigation -->
  <nav class="fixed bottom-0 left-0 w-full bg-white border-t shadow-md">
    <div class="max-w-7xl mx-auto flex justify-around items-center py-2">

      <!-- Products -->
      <a href="{% url 'catalog:wholesaler_dashboard' %}"
         class="flex flex-col items-center text-xs 
         {% if request.resolver_match.url_name == 'wholesaler_dashboard' and request.resolver_match.app_name == 'catalog' %}
           text-blue-600 font-medium
         {% else %}
           text-gray-500 hover:text-gray-800
         {% endif %}">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M20 13V7a2 2 0 00-2-2h-3V3H9v2H6a2 2 0 00-2 2v6h16zM4 17h16M4 21h16"/>
        </svg>
        <span>Products</span>
      </a>

      <!-- Orders -->
      <a href="{% url 'orders:list' %}"
         class="flex flex-col items-center text-xs 
         {% if request.resolver_match.app_name == 'orders' %}
           text-blue-600 font-medium
         {% else %}
           text-gray-500 hover:text-gray-800
         {% endif %}">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M3 3h18l-1 9H4L3 3zM16 13a4 4 0 11-8 0"/>
        </svg>
        <span>Orders</span>
      </a>

      <!-- Reports -->
      <a href="#"
         class="flex flex-col items-center text-xs 
         {% if request.resolver_match.url_name == 'product_list' %}
           text-blue-600 font-medium
         {% else %}
           text-gray-500 hover:text-gray-800
         {% endif %}">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M9 17v-6h13M9 7h13M3 3h2v18H3z"/>
        </svg>
        <span>Reports</span>
      </a>
    </div>
  </nav>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    // --- Dropdown Menu Logic ---
    document.querySelectorAll('.dropdown-toggle').forEach(button => {
        button.addEventListener('click', function (event) {
            event.stopPropagation(); // Prevents the document click from firing immediately
            const menu = this.nextElementSibling;
            // Close all other open dropdowns
            document.querySelectorAll('.dropdown-menu').forEach(m => {
                if (m !== menu) {
                    m.classList.add('hidden');
                }
            });
            // Toggle the clicked one
            menu.classList.toggle('hidden');
        });
    });

    // --- Click Away to Close ---
    document.addEventListener('click', function (event) {
        document.querySelectorAll('.dropdown-menu').forEach(menu => {
            if (!menu.contains(event.target) && !menu.previousElementSibling.contains(event.target)) {
                menu.classList.add('hidden');
            }
        });
    });
});
</script>
{% endblock %}