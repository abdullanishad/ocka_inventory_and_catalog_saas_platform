{% extends "base.html" %}
{% block content %}
<div class="max-w-5xl mx-auto p-6 bg-white rounded-xl shadow">
  <h1 class="text-2xl font-bold mb-4">{{ product.id|yesno:"Edit Product,New Product" }}</h1>

  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}

    <!-- Image + basics -->
    <div class="grid md:grid-cols-2 gap-6">
      <div>
        {% if form.instance.image %}
          <img src="{{ form.instance.image.url }}" class="w-40 h-40 object-cover rounded border mb-2">
        {% endif %}
        <label class="block text-sm font-medium">Image</label>
        {{ form.image }}
      </div>

      <div class="grid gap-3">
        <div>
          <label class="block text-sm font-medium">Name</label>
          {{ form.name }}
          {{ form.name.errors }}
        </div>
        <div>
          <label class="block text-sm font-medium">SKU</label>
          {{ form.sku }}
          {{ form.sku.errors }}
        </div>
      </div>
    </div>

    <div class="mt-4">
      <label class="block text-sm font-medium">Description</label>
      {{ form.description }}
      {{ form.description.errors }}
    </div>

    <!-- Attributes -->
    <div class="grid md:grid-cols-2 gap-6 mt-6">
      <div>
        <label class="block text-sm font-medium">Colours (multi)</label>
        {{ form.colors }}
        {{ form.colors.errors }}
      </div>

      <div>
        <label class="block text-sm font-medium">Fabric</label>
        {{ form.fabric }}
        <div class="text-xs text-gray-500 mt-1">Or add new:</div>
        {{ form.fabric_new }}
        {{ form.fabric.errors }}
      </div>

      <!-- <div>
        <label class="block text-sm font-medium">Fit Type</label>
        {{ form.fit_type }}
        <div class="text-xs text-gray-500 mt-1">Or add new:</div>
        {{ form.fit_type_new }}
        {{ form.fit_type.errors }}
      </div> -->
    </div>

    <!-- Pricing / MOQ -->
    <div class="grid md:grid-cols-3 gap-6 mt-6">
      <div>
        <label class="block text-sm font-medium">Wholesale Rate (≥10)</label>
        {{ form.wholesale_price }}
        {{ form.wholesale_price.errors }}
      </div>
      <div>
        <label class="block text-sm font-medium">Retail Price</label>
        {{ form.retail_price }}
        {{ form.retail_price.errors }}
      </div>
      <!-- <div>
        <label class="block text-sm font-medium">MOQ (≥1)</label>
        {{ form.minimum_order_qty }}
        {{ form.minimum_order_qty.errors }}
      </div> -->
    </div>

    <!-- Per-size stock -->
    <div class="mt-8">
      <h2 class="font-semibold mb-2">Sizes & Stock (quantity ≥ 1 per row)</h2>
      {{ formset.management_form }}
      <table class="min-w-full text-sm border rounded">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-3 py-2 text-left">Size</th>
            <th class="px-3 py-2 text-left">Quantity</th>
            <th class="px-3 py-2 text-left">Delete</th>
          </tr>
        </thead>
        <tbody>
          {% for f in formset.forms %}
            <tr class="border-t">
              <td class="px-3 py-2">{{ f.size }}{{ f.id }}</td>
              <td class="px-3 py-2">{{ f.quantity }}</td>
              <td class="px-3 py-2">{% if f.DELETE %}{{ f.DELETE }}{% endif %}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      {% if formset.non_form_errors %}<div class="text-red-600 mt-2">{{ formset.non_form_errors }}</div>{% endif %}
    </div>

    <div class="mt-6 flex gap-3">
      <button type="submit" class="bg-blue-600 text-white rounded px-5 py-2">Save</button>
      <a href="{% url 'catalog:wholesaler_dashboard' %}" class="text-gray-600">Cancel</a>
    </div>
  </form>
</div>
{% endblock %}
